# SPDX-License-Identifier: Apache-2.0
# SPDX-FileCopyrightText: Zygmunt Krynicki

project: pyclient
backends:
    garden:
        type: adhoc
        allocate: |
            if [ -n "${SPREAD_HOST_PATH-}" ]; then
                PATH="${SPREAD_HOST_PATH}"
            fi

            export QEMU_SMP_OPTION="-smp 2"
            export QEMU_MEM_OPTION="-m 1024"

            if OUT="$(image-garden allocate "${SPREAD_SYSTEM/-plus-/+}"."${ARCH:=$(uname -m)}")"; then
                  if [ "$ARCH" != "$(uname -m)" ]; then
                        # Spread has a fixed, 5-minute timeout for ssh to become ready.
                        # When emulating across architectures this may not be sufficient
                        # for the system to become ready. Sleep for a while to give things
                        # a chance to finish.
                        sleep 3m
                  fi
                  ADDRESS "$OUT"
            fi
        discard: |
            if [ -n "${SPREAD_HOST_PATH-}" ]; then
                PATH="${SPREAD_HOST_PATH}"
            fi

            image-garden discard "$SPREAD_SYSTEM_ADDRESS"
        systems:
            - ubuntu-cloud-22.04:
                  username: ubuntu
                  password: ubuntu
            - ubuntu-cloud-24.04:
                  username: ubuntu
                  password: ubuntu
            - ubuntu-cloud-25.04:
                  username: ubuntu
                  password: ubuntu
            - ubuntu-cloud-25.10:
                  username: ubuntu
                  password: ubuntu
            - ubuntu-core-20:
                  username: ubuntu
                  password: ubuntu
            - ubuntu-core-22:
                  username: ubuntu
                  password: ubuntu
            - ubuntu-core-24:
                  username: ubuntu
                  password: ubuntu
            # - archlinux-cloud:
            #       username: archlinux
            #       password: archlinux
            - debian-cloud-12:
                username: root
                password: root
            - fedora-cloud-42:
                username: root
                password: root
path: /tmp/demo
exclude:
    - .git
    - "*.qcow2"
    - "*.iso"
    - "*.img"
    - "*.log"
    - "*.run"
    - "*.pid"
    - ".image-garden/*"
suites:
    tests/smoke/:
        summary: Smoke tests
